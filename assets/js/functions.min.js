function toggleMainMenu(){$("#menu-toggle, #menu-toggle2").click(function(e){e.preventDefault(),$("#sidebar-wrapper").toggleClass("toggled")})}function addGroupToCalendar(){addthisevent.settings({license:"al7dliedlzlnbpbh0mbm",mouse:!1,css:!1,outlook:{show:!0,text:"Outlook Calendar"},google:{show:!0,text:"Google Calendar"},yahoo:{show:!1,text:"Yahoo Calendar"},ical:{show:!0,text:"iCal Calendar"},hotmail:{show:!1,text:"Hotmail Calendar"},facebook:{show:!1,text:"Facebook Calendar"}})}function toggleButton(){$(".js-acepto").on("change",function(){$(".js-login").hasClass("js-disabled")?$(".js-login").removeAttr("disabled").removeClass("js-disabled").addClass("js-enabled"):$(".js-login").hasClass("js-enabled")&&$(".js-login").attr("disabled","disabled").removeClass("js-enabled").addClass("js-disabled")})}function footerBottom(){var e=$("footer").outerHeight();$("body").css("padding-bottom",e)}function formValidation(e){$(e).validate({submitHandler:function(){switch(console.log("validacion"),e){case".j_group_form":createExchangeGroup();break;case".j_edit_group_form":editExchangeGroup();break;case".j-send-email":send_coupon_email();break;case".j-send-message-form":send_message_form()}}})}function setLimitDateDesktop(){var e=new Date,t=new Date(e);t.setDate(t.getDate()+1),$("#fecha-intercambio.j-datepicker").datepicker({minDate:"+1d",dateFormat:"yy-mm-dd"}),$("#fecha-limite.j-datepicker").datepicker({minDate:"0",dateFormat:"yy-mm-dd"}),$("#fecha-intercambio").on("change",function(){var e=new Date($(this).val()),t=new Date(e);t.setDate(t.getDate()-1),$("#fecha-limite").attr("max",t),$("#fecha-limite.j-datepicker").datepicker("option","maxDate",new Date(t))})}function setLimitDateMobile(){$("#fecha-intercambio").on("change",function(){var e=$(this).val(),e=e.split("-"),t=e[0],a=e[1],o=e[2],o=o-1,i=t+"-"+a+"-"+o;$("#fecha-limite").attr("max",i)});var e=new Date,t=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),a=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+(e.getDate()+1);$("#fecha-limite").attr("min",t),$("#fecha-intercambio").attr("min",a)}function runDatepicker(){$(".j-datepicker").length>0&&console.log(" datepicker! ")}function runIstitope(){var e=$(".isotope").imagesLoaded(function(){e.isotope({layoutMode:"fitRows",itemSelector:".j-item"})}),t={};$("#filters").on("click",".btn",function(){var a=$(this),o=a.parents(".button-group"),i=o.attr("data-filter-group");t[i]=a.attr("data-filter");var n="";for(var r in t)n+=t[r];e.isotope({filter:n})}),$(".button-group").each(function(e,t){var a=$(t);a.on("click","button",function(){a.find(".is-checked").removeClass("is-checked"),$(this).addClass("is-checked")})})}function lightbox(){$(document).delegate('*[data-toggle="lightbox"]',"click",function(e){e.preventDefault(),$(this).ekkoLightbox()})}function noLightbox(){$(document).delegate('*[data-toggle="lightbox"]',"click",function(e){e.preventDefault()})}function quitarOption(){$(".male.talla-jeans").on("change",function(){"18"==$(this).val()&&$('select.largo-jeans option[value="21"]').remove()})}function showSubmit(){$(".j-mobile-video-input").on("change",function(e){e.preventDefault(),""!=$(this).val()&&($(".j-mobile-video-button").show(),showLoaderSubmitVideo())})}function showLoaderSubmitVideo(){$(".j-mobile-video-button").on("click",function(){$(".loader-lightbox, .loader-lightbox .loader").show(),console.log("loading...")})}function send_coupon_email(){var e={};e.email=$(".j-send-email input").val();var t="/dashboard/send_coupon_by_email";$.post(t,e,function(){$(".j-send-email-notice").html(""),$(".j-send-email-notice").html("Se ha enviado tu correo")}),ga("send","event","cupón","click","enviarCorreo")}function send_message_form(){var e={};e.secret_friend_id=$(".j-secret_friend_id").val(),e.message=$(".j-send-message-form textarea").val(),e.group_friend_id=$(".j-group_friend_id").val();var t="/secret_friends/send_message";$.post(t,e,function(){window.location="/secret_friends/view/"+e.group_friend_id,$(".j-send-message-notice").html(""),$(".j-send-message-notice").html("Se ha enviado tu mensaje")}),ga("send","event","cupón","click","enviarMsj")}function createExchangeGroup(){var e=$(".hidden_guest").length;if(0==e)return $(".j_invite_friends-notice").html(""),void $(".j_invite_friends-notice").html("Debes invitar al menos a un amigo para crear un grupo");var t=$(".j_group_form").serialize(),a=localStorage.getItem("base_url")+"dashboard/create_exchange_group";$(".loader-lightbox, .loader-lightbox .loader").show(),$.post(a,t,function(){var e=localStorage.getItem("base_url")+"dashboard/view_coupon/ng";window.location=e})}function editExchangeGroup(){var e=$(".j_edit_group_form").serialize(),t=localStorage.getItem("base_url")+"dashboard/edit_exchange_group";$(".loader-lightbox, .loader-lightbox .loader").show(),$.post(t,e,function(){var e=localStorage.getItem("base_url")+"dashboard/index/";window.location=e})}function updatePerfectFit(){$(".j_update_perfect_fit button").on("click",function(e){e.preventDefault();var t=$(".j_update_perfect_fit").serialize(),a=localStorage.getItem("base_url")+"dashboard/create_perfect_fit";$.post(a,t,function(){var e=localStorage.getItem("base_url")+"dashboard/index/";window.location=e})})}function showSecretFriends(){$("a.j-secret-friends").on("click",function(e){e.preventDefault();var t=localStorage.getItem("base_url")+"secret_friends/get_secret_friends/";$.get(t,function(e){var t=$.parseJSON(e);$.each(t,function(e,t){var a=localStorage.getItem("base_url")+"secret_friends/create_message/"+t.group_friend_id;$(".j-modal ul").empty();var o="<li>";o+='<a href="'+a+'">',o+='<img class="[ one-quarter-width ] [ img-circle user-photo ] [ inline-block middle ]" src="'+t.friend_picture+'" /><div class="[ three-quarter-width ] [ inline-block middle ]">',o+="<p>"+t.name+"</p>",o+="<p>"+t.group+"</p>",o+="</div>",o+="</a>",o+="</li>",$(o).appendTo(".j-modal ul")}),$(".j-modal").show()})})}function videoPost(e){if(e.indexOf("https:")>-1){var t='<video controls><source src="'+e+'" type="video/mp4"></video>';return $(t).appendTo(".j-video"),void $("video").after('<div class="[ text-center ]"><a class="[ btn btn-primary btn-no ]" href="/dashboard"><span>Regresar</span></a></div>')}var a={input:e};$.ajax({type:"POST",url:"https://app.zencoder.com/api/v2/jobs",headers:{"Zencoder-Api-Key":"72d3c165590c75ac744e019d23cc22e1"},dataType:"json",data:JSON.stringify(a),success:function(e){var t='<video controls><source src="'+e.outputs[0].url+'" type="video/mp4"></video>';$(t).appendTo(".j-video")},error:function(){}})}function getUserActivity(){var e=localStorage.getItem("base_url")+"dashboard/get_user_activity/";$(".actividad-mensajes .loader").show(),$.get(e,function(e){$(".actividad-mensajes .loader").hide();var t=$.parseJSON(e);$.each(t,function(e,t){var a;switch(t.activity_type){case"1":a='<div class="[ margin-bottom ] [ actividad-aviso ]">',a+='<h4 class="[ text-center ]">'+t.action+"</h4>",a+='<p class="[ text-center ]">Has creado el grupo: '+t.group_name+"</p>",a+="</div>";break;case"2":a='<div class="[ margin-bottom ] [ actividad-aviso ]">',a+='<h4 class="[ text-center ]">'+t.action+"</h4>",a+='<img class="[ one-quarter-width ] [ img-circle user-photo ] [ inline-block middle ]" src="'+t.friend_pic+'" alt="" class="[ user-photo ]"><p class="[ three-quarter-width ] [ inline-block middle ]">'+t.friend_name+" se ha unido a tu grupo: "+t.group_name+"</p>",a+="</div>";break;case"3":a='<div class="[ margin-bottom ] [ actividad-aviso ]">',a+='<h4 class="[ text-center ]">'+t.action+"</h4>",a+='<img class="[ one-quarter-width ] [ img-circle user-photo ] [ inline-block middle ]" src="'+t.friend_pic+'" alt="" class="[ user-photo ]"><p class="[ three-quarter-width ] [ inline-block middle ]">'+t.friend_name+" ha rechazado la invitactión al grupo: "+t.group_name+"</p>",a+="</div>";break;case"5":console.log(t);var o=localStorage.getItem("base_url")+"secret_friends/view_video/"+t.group_friend_id;a='<div class="[ margin-bottom ] [ actividad-aviso ]">',a+='<h4 class="[ text-center ]">'+t.action+"</h4>",a+='<p class="[ text-center ]">Tienes un video de tu amigo secreto.</p>',a+='<div class="[ text-center ]"><a class="[ btn btn-primary btn-go ]" href="'+o+'"><span>Ver video</span></a></div>',a+="</div>"}$(a).appendTo(".actividad-grupo")})})}function acceptGroupInvitation(){$(".j-accept-invitation").on("click",function(e){e.preventDefault();var t=$(this).closest(".invitacion-intercambio"),a=$(this).closest(".invitacion-intercambio").find(".loader");a.show();var o={},i=localStorage.getItem("base_url")+"dashboard/accept_invitation";o.group_id=$(this).data("group"),$.post(i,o,function(){window.location="dashboard/view_group/"+o.group_id,$(t).after('<p class="[ text-center ]">Has aceptado la invitación.</p>'),t.remove()}),ga("send","event","solicitudes","click","aceptarIntercambio")})}function declineGroupInvitation(){$(".j-decline-invitation").on("click",function(e){e.preventDefault();var t=$(this).closest(".invitacion-intercambio"),a=($(this).closest(".invitacion-intercambio").find(".loader"),{}),o=localStorage.getItem("base_url")+"dashboard/decline_invitation";a.group_id=$(this).data("group"),a.invited_fb_user_id=$(this).data("friend"),console.log("group_data"),$.post(o,a,function(e){console.log(e),$(t).after('<p class="[ text-center ]">Has rechazado la invitación.</p>'),t.remove()}),ga("send","event","solicitudes","click","rechazarIntercambio")})}function removeGroupFriend(){$(".j-remove-friend").on("click",function(e){var t=$(this);e.preventDefault();var a={},o=localStorage.getItem("base_url")+"dashboard/remove_group_friend";a.group_id=$(this).data("group"),a.invited_fb_user_id=$(this).data("friend"),console.log(a),$.post(o,a,function(e){var a=e;console.log(a),"0"!=a.redirect&&(window.location="/dashboard/view_group/"+invited_friend_data.group_id),t.closest("li").after("<p>Se eliminó del intercambio.</p>"),t.closest("li").remove()})})}function removeInvitedFriend(){$(".j-remove-invitation").on("click",function(e){e.preventDefault();var t=$(this),a={},o=localStorage.getItem("base_url")+"dashboard/remove_invited_friend";a.group_id=$(this).data("group"),a.invited_fb_user_id=$(this).data("friend"),console.log(a),$.post(o,a,function(e){var o=e;"0"!=o.redirect&&(window.location="/dashboard/view_group/"+a.group_id),t.closest("li").after("<p>Se eliminó del intercambio.</p>"),t.closest("li").remove()})})}function setAccessToken(e){var t={};t.access_token=e;var a="/login/set_access_token";$.post(a,t,function(e){window.location="/dashboard",console.log(e)})}function loadFacebookSdk(){window.fbAsyncInit=function(){FB.init({appId:"723683944395366",cookie:!0,xfbml:!0,version:"v2.1"}),FB.Canvas.setSize({height:600}),setTimeout("FB.Canvas.setAutoGrow()",500),"login"==localStorage.getItem("current_view")&&checkLoginStatus()},function(e,t,a){var o,i=e.getElementsByTagName(t)[0];e.getElementById(a)||(o=e.createElement(t),o.id=a,o.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(o,i))}(document,"script","facebook-jssdk")}function inviteFriends(e){$(e+" .j_invite_friends").on("click",function(){FB.ui({method:"apprequests",message:"Te invito a formar parte del intercambio navideño y recibir un descuento en tus compras."},function(t){$(".j_invite_friends.error").remove(),$.each(t.to,function(t,a){var o=$('input[value="'+a+'"]');0==$(o).length&&($(e).append('<input type="hidden" class="hidden_guest" name="invited_friends[]" value="'+a+'">'),getInvitedFriendData(a))})})})}function getInvitedFriendData(e){FB.api("/"+e+"?access_token=723683944395366|2961c8a6e6af8194d36a8c9b56825b49",function(e){var t=[],a=!1;if(e.id){var o=e.first_name+" "+e.last_name;t.indexOf(o)>-1?a=!0:t.push(o),a||($(".j_invite_friends").after('<p class="[ agregado ]">Se agregó: '+o+" al intercambio.</p>"),$(".j_invite_friends-notice").html(""))}})}function getInvitedFriendPic(e){FB.api("/"+e+"/picture?access_token=723683944395366|2961c8a6e6af8194d36a8c9b56825b49",function(e){return e?e.url:void 0})}function shareFB(){$(".share-button").on("click",function(e){e.preventDefault(),FB.ui({method:"share",href:"https://dev-aeo-holiday.flockos.com/"},function(){})})}function checkLoginStatus(){FB.getLoginStatus(function(e){if("connected"===e.status){var t=(e.authResponse.userID,e.authResponse.accessToken);setAccessToken(t)}else"not_authorized"===e.status?($(".j-checking-login-status").hide(),$(".j-login-form").show()):($(".j-checking-login-status").hide(),$(".j-login-form").show());console.log(e)})}function initWebCam(){function e(){$("#recordStartButton").attr("disabled",!1)}function t(){$("#recordStartButton").attr("disabled",!0),$("#recordStopButton").attr("disabled",!1),$("#recordPauseResumeButton").attr("disabled",!1),$.scriptcam.startRecording()}function a(){$("#recordStopButton").attr("disabled",!0),$.scriptcam.closeCamera(),$("#message").html("Espera un momento, estamos convirtiendo tu video...")}function o(e){$("#recorder").hide(),fileName2=e.replace("mp4","gif"),$("#message").html("Gracias por grabar un video para tu amigo secreto.");e.replace(".mp4","");convertWebcamVideo(e)}function i(e,t){alert(t)}function n(e,t,a,o,i){console.log(e),console.log(t),console.log(a),console.log(o),console.log(i),$("#slider").slider("option","disabled",!1),$("#slider").slider("option","value",i),$.each(e,function(e,t){$("#cameraNames").append($("<option></option>").val(e).html(t))}),$("#cameraNames").val(t),$.each(a,function(e,t){$("#microphoneNames").append($("<option></option>").val(e).html(t))}),$("#microphoneNames").val(o)}$("#webcam").scriptcam({path:localStorage.getItem("base_url")+"assets/scriptcam/",fileReady:o,cornerRadius:0,cornerColor:"e3e5e2",onError:i,showMicrophoneErrors:!1,showDebug:!0,onWebcamReady:n,fileName:"demo549066",connected:e}),$("#recordStartButton").click(function(){t()}),$("#recordStopButton").click(function(){a()})}function convertWebcamVideo(e){var t={input:e};$.ajax({type:"POST",url:"https://app.zencoder.com/api/v2/jobs",headers:{"Zencoder-Api-Key":"72d3c165590c75ac744e019d23cc22e1"},dataType:"json",data:JSON.stringify(t),success:function(e){saveWebcamVideo(e.outputs[0].url)},error:function(){}})}function saveWebcamVideo(e){var t={},a=localStorage.getItem("base_url")+"secret_friends/save_webcam_video";t.secret_friend_id=$('input[name="secret_friend_id"]').val(),t.group_friend_id=$('input[name="group_friend_id"]').val(),t.video_url=e,$.post(a,t,function(){var e=(localStorage.getItem("base_url")+"secret_friends/view/"+t.group_friend_id,"/secret_friends/view/"+t.group_friend_id);$("#message").html('<div class="[ text-center ]"><a class="[ btn btn-primary btn-no ]" href="'+e+'"><span>regresar</span></a></div>')})}function getAppReports(){$(".j-get-reports button").on("click",function(e){e.preventDefault();var t={};t.start_date=$('input[name="start_date"]').val(),t.end_date=$('input[name="end_date"]').val(),getAcceptedInvitations(t),getPendingInvitations(t),getRejectedInvitations(t),getSentMessages(t),getUsers(t)})}function getAcceptedInvitations(e){var t="/cms/get_accepted_invitations_by_date";$(".j-invitaciones-aceptadas").html(""),$.post(t,e,function(e){if(0==e)return void $(".j-invitaciones-aceptadas").html("Sin resultados");var t=$.parseJSON(e),a=[],o=[];$.each(t,function(e,t){a.push(t.date),o.push(t.num_invitations)}),display_accepted_invitations_per_date(a,o)})}function getPendingInvitations(e){var t="/cms/get_pending_invitations_by_date";$(".j-invitaciones-pendientes").html(""),$.post(t,e,function(e){if(0==e)return void $(".j-invitaciones-pendientes").html("Sin resultados");var t=$.parseJSON(e),a=[],o=[];$.each(t,function(e,t){a.push(t.date),o.push(t.num_invitations)}),display_pending_invitations_per_date(a,o)})}function getRejectedInvitations(e){var t="/cms/get_rejected_invitations_by_date";$(".j-invitaciones-rechazadas").html(""),$.post(t,e,function(e){if(0==e)return void $(".j-invitaciones-rechazadas").html("Sin resultados");var t=$.parseJSON(e),a=[],o=[];$.each(t,function(e,t){a.push(t.date),o.push(t.num_invitations)}),display_rejected_invitations_per_date(a,o)})}function getSentMessages(e){var t="/cms/get_sent_messages_by_date";$(".j-mensajes-enviados").html(""),$.post(t,e,function(e){if(0==e)return void $(".j-mensajes-enviados").html("Sin resultados");var t=$.parseJSON(e),a=[],o=[];$.each(t,function(e,t){a.push(t.date),o.push(t.sent_messages)}),display_sent_messages_per_date(a,o)})}function getUsers(e){var t="/cms/get_users_by_date";$(".j-usuarios").html(""),$.post(t,e,function(e){if(0==e)return void $(".j-usuarios").html("Sin resultados");var t=$.parseJSON(e),a=[],o=[];$.each(t,function(e,t){a.push(t.date),o.push(t.num_users)}),display_users_per_date(a,o)})}function display_accepted_invitations_per_date(e,t){var a={labels:e,datasets:[{label:"Usuarios vs tiempo",fillColor:"rgba(255, 255, 255, 0.5)",strokeColor:"rgba(255, 255, 255, 1)",pointColor:"rgba(255, 255, 255, 0.8)",data:t}]},o=$("#accepted_invitations_per_date").get(0).getContext("2d");new Chart(o).Bar(a)}function display_pending_invitations_per_date(e,t){var a={labels:e,datasets:[{label:"Usuarios vs tiempo",fillColor:"rgba(255, 255, 255, 0.5)",strokeColor:"rgba(255, 255, 255, 1)",pointColor:"rgba(255, 255, 255, 0.8)",data:t}]},o=$("#pending_invitations_per_date").get(0).getContext("2d");new Chart(o).Bar(a)}function display_rejected_invitations_per_date(e,t){var a={labels:e,datasets:[{label:"Usuarios vs tiempo",fillColor:"rgba(255, 255, 255, 0.5)",strokeColor:"rgba(255, 255, 255, 1)",pointColor:"rgba(255, 255, 255, 0.8)",data:t}]},o=$("#rejected_invitations_per_date").get(0).getContext("2d");new Chart(o).Bar(a)}function display_sent_messages_per_date(e,t){var a={labels:e,datasets:[{label:"Usuarios vs tiempo",fillColor:"rgba(255, 255, 255, 0.5)",strokeColor:"rgba(255, 255, 255, 1)",pointColor:"rgba(255, 255, 255, 0.8)",data:t}]},o=$("#sent_messages_per_date").get(0).getContext("2d");new Chart(o).Bar(a)}function display_users_per_date(e,t){var a={labels:e,datasets:[{label:"Usuarios vs tiempo",fillColor:"rgba(255, 255, 255, 0.5)",strokeColor:"rgba(255, 255, 255, 1)",pointColor:"rgba(255, 255, 255, 0.8)",data:t}]},o=$("#users_per_date").get(0).getContext("2d");new Chart(o).Bar(a)}function dateRange(){$(".j-start_date").datepicker({changeMonth:!0,numberOfMonths:1,dateFormat:"yy-mm-dd",onClose:function(e){$(".j-end_date").datepicker("option","minDate",e)}}),$(".j-end_date").datepicker({changeMonth:!0,numberOfMonths:3,dateFormat:"yy-mm-dd",onClose:function(e){$("j-start_date").datepicker("option","maxDate",e)}})}
