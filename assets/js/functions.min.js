function toggleMainMenu(){$("#menu-toggle, #menu-toggle2").click(function(e){e.preventDefault(),$("#sidebar-wrapper").toggleClass("toggled")})}function addGroupToCalendar(){addthisevent.settings({license:"al7dliedlzlnbpbh0mbm",mouse:!1,css:!1,outlook:{show:!0,text:"Outlook Calendar"},google:{show:!0,text:"Google Calendar"},ical:{show:!0,text:"iCal Calendar"},facebook:{show:!1,text:"Facebook Event"},dropdown:{order:"google,ical,outlook"},callback:""})}function toggleButton(){$(".js-acepto").on("change",function(){$(".js-login").hasClass("js-disabled")?$(".js-login").removeAttr("disabled").removeClass("js-disabled").addClass("js-enabled"):$(".js-login").hasClass("js-enabled")&&$(".js-login").attr("disabled","disabled").removeClass("js-enabled").addClass("js-disabled")})}function footerBottom(){var e=$("footer").outerHeight();$("body").css("padding-bottom",e)}function formValidation(e){$(e).validate({submitHandler:function(){switch(e){case".j_group_form":createExchangeGroup();break;case".j_edit_group_form":editExchangeGroup()}}})}function setLimitDate(){$("#fecha-intercambio").on("change",function(){var e=$(this).val(),e=e.split("-"),t=e[0],a=e[1],i=e[2],i=i-1,n=t+"-"+a+"-"+i;$("#fecha-limite").attr("max",n)})}function runDatepicker(){$(".j-datepicker").datepicker()}function runIstitope(){var e=$(".isotope").imagesLoaded(function(){e.isotope({itemSelector:".j-item"})}),t={};$("#filters").on("click",".btn",function(){var a=$(this),i=a.parents(".button-group"),n=i.attr("data-filter-group");t[n]=a.attr("data-filter");var o="";for(var r in t)o+=t[r];e.isotope({filter:o})}),$(".button-group").each(function(e,t){var a=$(t);a.on("click","button",function(){a.find(".is-checked").removeClass("is-checked"),$(this).addClass("is-checked")})})}function lightbox(){$(document).delegate('*[data-toggle="lightbox"]',"click",function(e){e.preventDefault(),$(this).ekkoLightbox()})}function noLightbox(){$(document).delegate('*[data-toggle="lightbox"]',"click",function(e){e.preventDefault()})}function quitarOption(){$(".male.talla-jeans").on("change",function(){"18"==$(this).val()&&$('select.largo-jeans option[value="21"]').remove()})}function send_coupon_email(){$(".j-send-email a").on("click",function(e){e.preventDefault();var t={};t.email=$(".j-send-email input").val();var a="/dashboard/send_coupon_by_email";$.post(a,t,function(){$("<p>Se ha enviado tu correo</p>").appendTo(".j-send-email")}),ga("send","event","cupón","click","enviarCorreo")})}function createExchangeGroup(){var e=$(".hidden_guest").length;if(0==e)return void $(".j_invite_friends").after('<p class="[ j_invite_friends error ]">Debes invitar al menos a un amigo para crear un grupo</p>');var t=$(".j_group_form").serialize(),a=localStorage.getItem("base_url")+"dashboard/create_exchange_group";$(".loader-lightbox, .loader").show(),$.post(a,t,function(){var e=localStorage.getItem("base_url")+"dashboard/view_coupon/ng";window.location=e})}function editExchangeGroup(){var e=$(".j_edit_group_form").serialize(),t=localStorage.getItem("base_url")+"dashboard/edit_exchange_group";$.post(t,e,function(){var e=localStorage.getItem("base_url")+"dashboard/index/";window.location=e})}function updatePerfectFit(){$(".j_update_perfect_fit button").on("click",function(e){e.preventDefault();var t=$(".j_update_perfect_fit").serialize(),a=localStorage.getItem("base_url")+"dashboard/create_perfect_fit";$.post(a,t,function(){var e=localStorage.getItem("base_url")+"dashboard/index/";window.location=e})})}function showSecretFriends(){$("a.j-secret-friends").on("click",function(e){e.preventDefault();var t=localStorage.getItem("base_url")+"secret_friends/get_secret_friends/";$.get(t,function(e){var t=$.parseJSON(e);$.each(t,function(e,t){var a=localStorage.getItem("base_url")+"secret_friends/create_message/"+t.group_friend_id,i="<li>";i+='<a href="'+a+'">',i+='<img class="[ one-quarter-width ] [ img-circle user-photo ] [ inline-block middle ]" src="'+t.friend_picture+'" /><div class="[ three-quarter-width ] [ inline-block middle ]">',i+="<p>"+t.name+"</p>",i+="<p>"+t.group+"</p>",i+="</div>",i+="</a>",i+="</li>",$(i).appendTo(".j-modal ul")}),$(".j-modal").show()})})}function videoPost(e){if(e.indexOf("https:")>-1){var t='<video controls><source src="'+e+'" type="video/mp4"></video>';return $(t).appendTo(".j-video"),void $("video").after('<div class="[ text-center ]"><a class="[ btn btn-primary btn-no ]" href="/dashboard"><span>Regresar</span></a></div>')}var a={input:e};$.ajax({type:"POST",url:"https://app.zencoder.com/api/v2/jobs",headers:{"Zencoder-Api-Key":"72d3c165590c75ac744e019d23cc22e1"},dataType:"json",data:JSON.stringify(a),success:function(e){var t='<video controls><source src="'+e.outputs[0].url+'" type="video/mp4"></video>';$(t).appendTo(".j-video")},error:function(){}})}function getUserActiviy(){var e=localStorage.getItem("base_url")+"dashboard/get_user_activity/";$(".actividad-mensajes .loader").show(),$.get(e,function(e){$(".actividad-mensajes .loader").hide();var t=$.parseJSON(e);$.each(t,function(e,t){var a;switch(t.activity_type){case"1":a='<div class="[ margin-bottom ] [ actividad-aviso ]">',a+='<h4 class="[ text-center ]">'+t.action+"</h4>",a+='<p class="[ text-center ]">Has creado el grupo: '+t.group_name+"</p>",a+="</div>";break;case"2":a='<div class="[ margin-bottom ] [ actividad-aviso ]">',a+='<h4 class="[ text-center ]">'+t.action+"</h4>",a+='<img class="[ one-quarter-width ] [ img-circle user-photo ] [ inline-block middle ]" src="'+t.friend_pic+'" alt="" class="[ user-photo ]"><p class="[ three-quarter-width ] [ inline-block middle ]">'+t.friend_name+" se ha unido a tu grupo: "+t.group_name+"</p>",a+="</div>";break;case"3":a='<div class="[ margin-bottom ] [ actividad-aviso ]">',a+='<h4 class="[ text-center ]">'+t.action+"</h4>",a+='<img class="[ one-quarter-width ] [ img-circle user-photo ] [ inline-block middle ]" src="'+t.friend_pic+'" alt="" class="[ user-photo ]"><p class="[ three-quarter-width ] [ inline-block middle ]">'+t.friend_name+" ha rechazado la invitactión al grupo: "+t.group_name+"</p>",a+="</div>";break;case"5":a='<div class="[ margin-bottom ] [ actividad-aviso ]">',a+='<h4 class="[ text-center ]">'+t.action+"</h4>",a+='<p class="[ text-center ]">Tienes un video de tu amigo secreto.</p>',a+="</div>"}$(a).appendTo(".actividad-grupo")})})}function acceptGroupInvitation(){$(".j-accept-invitation").on("click",function(e){e.preventDefault();var t=$(this).closest(".invitacion-intercambio"),a=$(this).closest(".invitacion-intercambio").find(".loader");a.show();var i={},n=localStorage.getItem("base_url")+"dashboard/accept_invitation";i.group_id=$(this).data("group"),$.post(n,i,function(){$(t).after('<p class="[ text-center ]">Has aceptado la invitación.</p>'),t.remove()}),ga("send","event","solicitudes","click","aceptarIntercambio")})}function declineGroupInvitation(){$(".j-decline-invitation").on("click",function(e){e.preventDefault();var t=$(this).closest(".invitacion-intercambio"),a=($(this).closest(".invitacion-intercambio").find(".loader"),{}),i=localStorage.getItem("base_url")+"dashboard/decline_invitation";a.group_id=$(this).data("group"),$.post(i,a,function(){$(t).after('<p class="[ text-center ]">Has rechazado la invitación.</p>'),t.remove()}),ga("send","event","solicitudes","click","rechazarIntercambio")})}function removeGroupFriend(){$(".j-remove-friend").on("click",function(e){var t=$(this);e.preventDefault();var a={},i=localStorage.getItem("base_url")+"dashboard/remove_group_friend";a.group_id=$(this).data("group"),a.friend_id=$(this).data("friend"),$.post(i,a,function(){t.closest("li").after("<p>Se eliminó del intercambio.</p>"),t.closest("li").remove()})})}function removeInvitedFriend(){$(".j-remove-invitation").on("click",function(e){e.preventDefault();var t=$(this),a={},i=localStorage.getItem("base_url")+"dashboard/remove_invited_friend";a.group_id=$(this).data("group"),a.invited_fb_user_id=$(this).data("fb-user"),$.post(i,a,function(){t.closest("li").after("<p>Se eliminó del intercambio.</p>"),t.closest("li").remove()})})}function loadFacebookSdk(){!function(e,t,a){var i,n=e.getElementsByTagName(t)[0];e.getElementById(a)||(i=e.createElement(t),i.id=a,i.src="//connect.facebook.net/en_US/sdk.js",n.parentNode.insertBefore(i,n))}(document,"script","facebook-jssdk"),window.fbAsyncInit=function(){FB.init({appId:"293571087508858",cookie:!0,xfbml:!0,version:"v2.1"}),FB.Canvas.setSize({height:600}),setTimeout("FB.Canvas.setAutoGrow()",500)}}function inviteFriends(e){$(e+" .j_invite_friends").on("click",function(){FB.ui({method:"apprequests",message:"Te invito a formar parte del intercambio navideño y recibir un descuento en tus compras."},function(t){$.each(t.to,function(t,a){$(e).append('<input type="hidden" class="hidden_guest" name="invited_friends[]" value="'+a+'">'),getInvitedFriendData(a)}),$(".j_invite_friends.error").remove()})})}function getInvitedFriendData(e){FB.api("/"+e+"?access_token=293571087508858|21d0205237f8a0afec65c14533565773",function(e){if(e.id){var t=e.first_name+" "+e.last_name;$(".j_invite_friends").after("<p>Se agregó: "+t+" al intercambio.</p>")}})}function getInvitedFriendPic(e){FB.api("/"+e+"/picture?access_token=293571087508858|21d0205237f8a0afec65c14533565773",function(e){return e?e.url:void 0})}function initWebCam(){function e(){$("#recordStartButton").attr("disabled",!1)}function t(){$("#recordStartButton").attr("disabled",!0),$("#recordStopButton").attr("disabled",!1),$("#recordPauseResumeButton").attr("disabled",!1),$.scriptcam.startRecording(),r()}function a(){$("#recordStopButton").attr("disabled",!0),$.scriptcam.closeCamera(),$("#message").html("Espera un momento, estamos convirtiendo tu video...")}function i(e){$("#recorder").hide(),fileName2=e.replace("mp4","gif"),$("#message").html("Gracias por grabar un video para tu amigo secreto.");e.replace(".mp4","");convertWebcamVideo(e)}function n(e,t){alert(t)}function o(e,t,a,i,n){$("#slider").slider("option","disabled",!1),$("#slider").slider("option","value",n),$.each(e,function(e,t){$("#cameraNames").append($("<option></option>").val(e).html(t))}),$("#cameraNames").val(t),$.each(a,function(e,t){$("#microphoneNames").append($("<option></option>").val(e).html(t))}),$("#microphoneNames").val(i)}function r(){function e(){n--,$(".j-timer").html(n),0==n&&(a(),t())}function t(){clearInterval(i)}var i=setInterval(function(){e()},1e3),n=15}$("#webcam").scriptcam({path:localStorage.getItem("base_url")+"assets/scriptcam/",fileReady:i,cornerRadius:0,cornerColor:"e3e5e2",onError:n,showMicrophoneErrors:!1,showDebug:!0,onWebcamReady:o,fileName:"demo549066",connected:e}),$("#recordStartButton").click(function(){t()}),$("#recordStopButton").click(function(){a()})}function convertWebcamVideo(e){var t={input:e};$.ajax({type:"POST",url:"https://app.zencoder.com/api/v2/jobs",headers:{"Zencoder-Api-Key":"72d3c165590c75ac744e019d23cc22e1"},dataType:"json",data:JSON.stringify(t),success:function(e){saveWebcamVideo(e.outputs[0].url)},error:function(){}})}function saveWebcamVideo(e){var t={},a=localStorage.getItem("base_url")+"secret_friends/save_webcam_video";t.secret_friend_id=$('input[name="secret_friend_id"]').val(),t.group_friend_id=$('input[name="group_friend_id"]').val(),t.video_url=e,$.post(a,t,function(){var e=(localStorage.getItem("base_url")+"secret_friends/view/"+t.group_friend_id,"/secret_friends/view/"+t.group_friend_id);$("#message").html('<div class="[ text-center ]"><a class="[ btn btn-primary btn-no ]" href="'+e+'"><span>regresar</span></a></div>')})}function getAppReports(){$(".j-get-reports button").on("click",function(e){e.preventDefault();var t={};t.start_date=$('input[name="start_date"]').val(),t.end_date=$('input[name="end_date"]').val(),getAcceptedInvitations(t),getPendingInvitations(t),getRejectedInvitations(t),getSentMessages(t),getUsers(t)})}function getAcceptedInvitations(e){var t="/cms/get_accepted_invitations_by_date";$(".j-invitaciones-aceptadas").html(""),$.post(t,e,function(e){if(0==e)return void $(".j-invitaciones-aceptadas").html("Sin resultados");var t=$.parseJSON(e),a=[],i=[];$.each(t,function(e,t){a.push(t.date),i.push(t.num_invitations)}),display_accepted_invitations_per_date(a,i)})}function getPendingInvitations(e){var t="/cms/get_pending_invitations_by_date";$(".j-invitaciones-pendientes").html(""),$.post(t,e,function(e){if(0==e)return void $(".j-invitaciones-pendientes").html("Sin resultados");var t=$.parseJSON(e),a=[],i=[];$.each(t,function(e,t){a.push(t.date),i.push(t.num_invitations)}),display_pending_invitations_per_date(a,i)})}function getRejectedInvitations(e){var t="/cms/get_rejected_invitations_by_date";$(".j-invitaciones-rechazadas").html(""),$.post(t,e,function(e){if(0==e)return void $(".j-invitaciones-rechazadas").html("Sin resultados");var t=$.parseJSON(e),a=[],i=[];$.each(t,function(e,t){a.push(t.date),i.push(t.num_invitations)}),display_rejected_invitations_per_date(a,i)})}function getSentMessages(e){var t="/cms/get_sent_messages_by_date";$(".j-mensajes-enviados").html(""),$.post(t,e,function(e){if(0==e)return void $(".j-mensajes-enviados").html("Sin resultados");var t=$.parseJSON(e),a=[],i=[];$.each(t,function(e,t){a.push(t.date),i.push(t.sent_messages)}),display_sent_messages_per_date(a,i)})}function getUsers(e){var t="/cms/get_users_by_date";$(".j-usuarios").html(""),$.post(t,e,function(e){if(0==e)return void $(".j-usuarios").html("Sin resultados");var t=$.parseJSON(e),a=[],i=[];$.each(t,function(e,t){a.push(t.date),i.push(t.num_users)}),display_users_per_date(a,i)})}function display_accepted_invitations_per_date(e,t){var a={labels:e,datasets:[{label:"Usuarios vs tiempo",fillColor:"rgba(255, 255, 255, 0.5)",strokeColor:"rgba(255, 255, 255, 1)",pointColor:"rgba(255, 255, 255, 0.8)",data:t}]},i=$("#accepted_invitations_per_date").get(0).getContext("2d");new Chart(i).Bar(a)}function display_pending_invitations_per_date(e,t){var a={labels:e,datasets:[{label:"Usuarios vs tiempo",fillColor:"rgba(255, 255, 255, 0.5)",strokeColor:"rgba(255, 255, 255, 1)",pointColor:"rgba(255, 255, 255, 0.8)",data:t}]},i=$("#pending_invitations_per_date").get(0).getContext("2d");new Chart(i).Bar(a)}function display_rejected_invitations_per_date(e,t){var a={labels:e,datasets:[{label:"Usuarios vs tiempo",fillColor:"rgba(255, 255, 255, 0.5)",strokeColor:"rgba(255, 255, 255, 1)",pointColor:"rgba(255, 255, 255, 0.8)",data:t}]},i=$("#rejected_invitations_per_date").get(0).getContext("2d");new Chart(i).Bar(a)}function display_sent_messages_per_date(e,t){var a={labels:e,datasets:[{label:"Usuarios vs tiempo",fillColor:"rgba(255, 255, 255, 0.5)",strokeColor:"rgba(255, 255, 255, 1)",pointColor:"rgba(255, 255, 255, 0.8)",data:t}]},i=$("#sent_messages_per_date").get(0).getContext("2d");new Chart(i).Bar(a)}function display_users_per_date(e,t){var a={labels:e,datasets:[{label:"Usuarios vs tiempo",fillColor:"rgba(255, 255, 255, 0.5)",strokeColor:"rgba(255, 255, 255, 1)",pointColor:"rgba(255, 255, 255, 0.8)",data:t}]},i=$("#users_per_date").get(0).getContext("2d");new Chart(i).Bar(a)}function dateRange(){$(".j-start_date").datepicker({changeMonth:!0,numberOfMonths:1,dateFormat:"yy-mm-dd",onClose:function(e){$(".j-end_date").datepicker("option","minDate",e)}}),$(".j-end_date").datepicker({changeMonth:!0,numberOfMonths:3,dateFormat:"yy-mm-dd",onClose:function(e){$("j-start_date").datepicker("option","maxDate",e)}})}
